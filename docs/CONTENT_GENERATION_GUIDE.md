# AI Content Generation Guide

This guide explains how the PropertyPro AI platform produces marketing and advisory content using the domain services found in `backend/app/domain/ai`. It replaces the outdated AURA-era notes and reflects the current retrieval-augmented generation (RAG) stack documented in `docs/handbook/backend.md` Section 11.

## Architecture Recap
1. **Retrieval** — `rag_service.py` embeds user queries, pulls relevant context from ChromaDB, and assembles structured prompts.
2. **Generation** — `ai_manager.py` invokes Gemini (`AI_MODEL` env var) with role-specific instructions and guardrails.
3. **Post-processing** — `response_enhancer.py` and `action_engine.py` shape the output into sections, apply compliance language, and queue follow-up tasks where appropriate.
4. **Delivery** — Content surfaces through `/ai/assist`, marketing campaign builders, or scheduled nurturing sequences.

## Supported Content Types
| Content Type | Primary Entry Point | Supporting Modules | Notes |
| --- | --- | --- | --- |
| Daily Agent Briefing | `/ai/assist` with `intent=MARKET_INFO` | `analytics_service.py`, `reporting_service.py` | Summarizes market shifts, portfolio alerts, and top tasks. |
| CMA Executive Summary | `/reports/cma` | `reporting_service.py`, `document_processing_service.py` | Blends comparable properties, pricing deltas, and narrative commentary. |
| Listing Description | `/properties/{id}` -> enrichment task | `property_detection_service.py`, `response_enhancer.py` | Generates SEO-aware listing copy matched to property data. |
| Follow-up Email Draft | `/nurturing/sequences` | `client_nurturing_service.py`, `notification_service.py` | Uses client preferences and recent interactions to craft personalized outreach. |
| Social Post Set | `/marketing/campaigns` | `brand_management_service.py`, `social_media_router.py` | Produces multi-channel posts with platform-specific tone and CTAs. |
| Voice Script | `/ai/assist` with `intent=VOICE_SCRIPT` (beta) | `voice_processing_service.py`, `ai_enhancements.py` | Generates conversational scripts for phone follow-ups or kiosk demos. |

## Prompt Controls
- **Persona**: Selected based on endpoint (e.g., Agent Advisor, Marketing Strategist) and controlled by prompt fragments in `rag_service.py`.
- **Tone**: Adjustable via request payload (`tone=professional/casual/investor`). Defaults to professional, data-driven voice.
- **Language**: Optional `language` field triggers translation and localized data (ensure dataset coverage before enabling).
- **Compliance**: Always include policy reminders pulled from curated knowledge base; compliance service flags risky statements.

## Extending Content Types
1. Define a new `QueryIntent` enum in `rag_service.py` and update intent mapping in `action_engine.py`.
2. Create or update domain service to assemble context (e.g., `market_insights_service` for future features).
3. Add prompt template fragment referencing new intent, including structure and guardrails.
4. Register endpoint or workflow step that sets the new intent and supplies required parameters.
5. Update this guide and `docs/handbook/backend.md` to document the addition.

## Frontend Integration Tips
- Web client uses `aiCoordinator.sendMessage` to route chat prompts; pass `metadata.intent` when requesting specific outputs.
- Marketing UI persists AI drafts to state and allows manual edits before scheduling.
- Nurturing sequences store generated content per step; users can approve before sending.
- Provide inline attribution (e.g., “Generated by PropertyPro AI”) for transparency.

## Quality and Feedback Loop
1. Users can rate outputs via `/feedback`; low ratings trigger review in `human_expertise_service.py`.
2. Reviewers update content or add notes which feed future prompt adjustments.
3. Track completion and feedback metrics in `analytics_router` dashboards.
4. Regularly refresh embeddings and curated content to keep AI guidance aligned with current market data.

Maintain this document as you add new content formats so marketing, product, and engineering teams stay aligned on AI capabilities and guardrails.
