# Phase 3, Sprint 7: Advanced AI Recipes

## ðŸŽ¯ Objective
Expand the application's intelligence by implementing more complex, multi-step AI recipes for transaction coordination and automated client nurturing.

## Associated Files

### Backend
- `/backend/app/services/task_orchestrator_service.py` (Add new intents)
- `/backend/app/services/ai_service.py` (Add new generation methods)
- `/backend/app/models/transaction.py` (New)
- `/backend/app/schemas/transaction.py` (New)
- `/backend/app/api/v1/endpoints/transactions.py` (New)

### Frontend
- `/frontend/src/screens/TransactionView.tsx` (New)
- `/frontend/src/components/TransactionPipeline.tsx` (New)

## Implementation Details

### 1. "Transaction Coordination" Recipe

-   **Backend**:
    -   Define a `Transaction` model to track key dates, documents, and contacts for a property sale.
    -   Add a `'COORDINATE_TRANSACTION'` intent to the `request_parser_service`.
    -   When a user says, *"Start transaction coordination for 123 Main St"*, the `task_orchestrator_service` should:
        1.  Create a new `Transaction` record.
        2.  Generate a series of tasks with deadlines based on a standard transaction timeline (e.g., 'Submit legal documents', 'Schedule inspection', 'Client final walkthrough').
        3.  Assign these tasks to the user.
-   **Frontend**:
    -   Create a `TransactionView.tsx` screen.
    -   This screen will display the transaction timeline, associated tasks, and contact information.
    -   A `TransactionPipeline.tsx` component could visualize the current stage of the deal (e.g., 'Offer Accepted', 'In Escrow', 'Closed').

### 2. "Client Nurturing" Recipe

-   **Backend**:
    -   This recipe is proactive rather than user-initiated. Create a scheduled background job that runs daily.
    -   The job will identify clients who haven't been contacted recently (e.g., in the last 14 days) but are marked as 'hot' or 'warm' leads.
    -   For each of these clients, the job will trigger the `ai_service` to generate a personalized follow-up email. The prompt should include the client's history, preferences, and recent market activity.
    -   The generated email will be saved as a 'draft' and a task will be created for the agent: *"Review and send follow-up email to [Client Name]"*.
-   **Frontend**:
    -   No new screens are needed. The results of this recipe will appear as new tasks in the agent's task list.
    -   Clicking the task could open a pre-populated email client or an in-app email composer.

## âœ… Acceptance Criteria
-   **Transaction Coordination**:
    -   [ ] A voice/text command to start a transaction correctly creates a transaction record and a list of corresponding tasks.
    -   [ ] The `TransactionView` screen accurately displays the timeline and tasks for a given deal.
-   **Client Nurturing**:
    -   [ ] The daily background job correctly identifies clients needing a follow-up.
    -   [ ] A new task with a drafted, AI-generated email is created for the agent to review.
-   **General**:
    -   [ ] The new recipes are integrated smoothly into the existing request/task management system.
