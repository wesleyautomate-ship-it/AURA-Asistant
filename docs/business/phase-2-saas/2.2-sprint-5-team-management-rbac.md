# Phase 2, Sprint 5: Team Management & Roles

## ðŸŽ¯ Objective
Implement a Role-Based Access Control (RBAC) system and provide a user interface for organization administrators to invite and manage team members, enabling collaborative use of the AI recipes.

## Associated Files

### Backend
- `/backend/app/models/user.py` (Add `role` field)
- `/backend/app/schemas/user.py` (Update schemas to include role)
- `/backend/app/core/dependencies.py` (Create role-checking dependency)
- `/backend/app/services/team_service.py`
- `/backend/app/api/v1/endpoints/team.py`

### Frontend
- `/frontend/src/screens/TeamManagementScreen.tsx`
- `/frontend/src/services/teamService.ts`
- `/frontend/src/components/TeamMemberCard.tsx`

## Implementation Details

### 1. Backend Development

-   **RBAC Model**:
    -   Add a `role` field to the `User` model (e.g., an `Enum` with values like `admin`, `member`). The first user of an organization defaults to `admin`.
    -   Include the user's `role` in the JWT payload to allow for efficient permission checking on the frontend and backend.

-   **Permission Decorators**:
    -   In `core/dependencies.py`, create a reusable dependency (e.g., `get_current_admin_user`) that verifies the user is authenticated and has the 'admin' role.
    -   Apply this dependency to all API endpoints that should be restricted to admins, such as billing and team management endpoints.

-   **Team Management Service**:
    -   Create `services/team_service.py` with methods for:
        -   `invite_user(email: str, role: str)`: Generates an invitation and sends an email.
        -   `accept_invitation(token: str)`: Allows a new user to register and join an existing organization.
        -   `list_members()`: Lists all users within the current user's organization.
        -   `remove_member(user_id: str)`: Removes a user from the organization.

-   **Team API Endpoints**:
    -   Create `api/v1/endpoints/team.py` with endpoints for inviting, listing, and removing team members, protected by the new admin-only dependency.

### 2. Frontend Development

-   **Team Management UI (`TeamManagementScreen.tsx`)**:
    -   Create a screen, accessible only to admins, that displays a list of team members using a `TeamMemberCard` component.
    -   Include a form to invite new members by email and assign them a role.
    -   Allow admins to remove members from the team.

-   **Role-based UI**:
    -   Modify the main navigation to hide administrative sections like "Team Management" and "Billing" from non-admin users.
    -   The `userStore` should contain the current user's role to facilitate these checks.

-   **Collaboration**:
    -   Ensure that when a `member` role user creates a request (e.g., a CMA), it is visible to the `admin` of that organization in the `RequestManager`. All data within an organization should be shared, but management capabilities are restricted.

## âœ… Acceptance Criteria
-   **Backend**:
    -   [ ] The `role` field is added to the `User` model and included in the JWT.
    -   [ ] The admin-only dependency correctly protects endpoints.
    -   [ ] Admins can successfully invite, list, and remove users from their organization.
-   **Frontend**:
    -   [ ] The "Team Management" screen is only visible to admin users.
    -   [ ] Admins can manage their team roster as described.
    -   [ ] Non-admin users cannot see or access administrative UI elements.
    -   [ ] All members of an organization can see the requests and results generated by other team members.